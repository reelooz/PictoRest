// Generated by CoffeeScript 1.6.3
(function() {
  window.rechercheAjax = function(idUtil) {
    var tabid, tache;
    tache = $("#recherche").val();
    tabid = [];
    return $.getJSON("/PictoRest/rest/albums?filter=" + tache + "&callback=?", function(data) {
      var d, element, idAlb, photos, section, _i, _len, _results;
      $('section').remove();
      $('#rech').remove();
      $('#photo').remove();
      section = '<div id="rech"></div>';
      element = jQuery(section);
      $('body').append(element);
      _results = [];
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        d = data[_i];
        idAlb = d['idAlbum'];
        photos = '<a class="aphoto" href="/PictoRest/profil/' + d['idAlbum'] + '">\
                      <div id="' + idAlb + '" class="photo">\
                        <p class="titrePhoto">' + d['titreAlbum'] + '</p>';
        $.getJSON("/PictoRest/rest/photoRecherche/" + d['photoCouv'] + "?callback=?", function(data) {
          photos += '<img src="' + data['cheminThumb'] + '"/>\
                        <p class="description">' + d['desc'] + '</p>\
                      </div>\
                  </a>';
          element = jQuery(photos);
          return $('#rech').append(element);
        });
        _results.push(tabid.push(d['idAlbum']));
      }
      return _results;
    }).done(function() {
      var photos, tabFeed;
      tabFeed = [];
      photos = '';
      return $.getJSON("/PictoRest/rest/users/" + idUtil + "/feeds?callback=?", function(dataFeed) {
        var feeds, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = dataFeed.length; _i < _len; _i++) {
          feeds = dataFeed[_i];
          _results.push(tabFeed.push(feeds));
        }
        return _results;
      }).done(function() {
        var element, feed, id, _i, _j, _len, _len1;
        for (_i = 0, _len = tabid.length; _i < _len; _i++) {
          id = tabid[_i];
          console.log(id);
          for (_j = 0, _len1 = tabFeed.length; _j < _len1; _j++) {
            feed = tabFeed[_j];
            console.log(feed['idAlbum'] + ' ' + id);
            if (feed['idAlbum'] !== id) {
              photos = '<a onClick="ajoutFeed(' + feed['idAlbum'] + ',' + id + ')">S\'abonner</a>';
            } else {
              console.log('ok');
              photos = '';
              break;
            }
          }
          element = jQuery(photos);
          console.log(photos);
          $('#' + id + ':last-child').append(element);
          photos = '';
        }
        return tabFeed = [];
      });
    }).fail(function() {
      var element, photos;
      $('section').remove();
      photos = '<section>';
      photos += '<p>Aucun r√©sultat</p>';
      photos += '</section>';
      element = jQuery(photos);
      return $('body').append(element);
    });
  };

  window.afficheflux = function(id) {
    var element, photos, tabAlbUtil, tabFeed, tabPhotos;
    tabFeed = [];
    tabAlbUtil = [];
    tabPhotos = [];
    $('section').remove();
    $('#rech').remove();
    $('#photo').remove();
    photos = '<div id="rech"> </div>';
    element = jQuery(photos);
    $('body').append(element);
    photos = '';
    return $.getJSON("/PictoRest/rest/users/" + id + "/feeds?callback=?", function(data) {
      var feed, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        feed = data[_i];
        _results.push(tabFeed.push(feed));
      }
      return _results;
    }).done(function() {
      var feed, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = tabFeed.length; _i < _len; _i++) {
        feed = tabFeed[_i];
        _results.push($.getJSON("/PictoRest/rest/albums/" + feed['idAlbum'] + "/photos?callback=?", function(dataPhoto) {
          var photo, _j, _len1, _results1;
          _results1 = [];
          for (_j = 0, _len1 = dataPhoto.length; _j < _len1; _j++) {
            photo = dataPhoto[_j];
            _results1.push(tabPhotos.push(photo));
          }
          return _results1;
        }).done(function() {
          var photo, _j, _len1;
          for (_j = 0, _len1 = tabPhotos.length; _j < _len1; _j++) {
            photo = tabPhotos[_j];
            photos += '<a class="aphoto" href="/PictoRest/photo/' + photo['idPhoto'] + '">\
                          <div id="' + photo['idPhoto'] + '" class="photo">\
                            <p class="titrePhoto">' + photo['titrePhoto'] + '</p>\
                            <img src="' + photo['cheminThumb'] + '">\
                            <p class="description">' + photo['desc'] + '</p>\
                            </div>\
                          </a>';
            element = jQuery(photos);
            $('#rech').append(element);
            photos = '';
          }
          return $.getJSON("/PictoRest/rest/users/" + id + "/albums?callback=?", function(dataUtil) {
            var albums, _k, _len2, _results1;
            _results1 = [];
            for (_k = 0, _len2 = dataUtil.length; _k < _len2; _k++) {
              albums = dataUtil[_k];
              _results1.push(tabAlbUtil.push(albums));
            }
            return _results1;
          }).done(function() {
            var albums, _k, _len2, _results1;
            console.log(tabAlbUtil);
            _results1 = [];
            for (_k = 0, _len2 = tabAlbUtil.length; _k < _len2; _k++) {
              albums = tabAlbUtil[_k];
              console.log(albums);
              console.log(albums['idAlbum']);
              photos = '<a class="aphoto" href="/PictoRest/profil/' + albums['idAlbum'] + '">\
                          <div id="' + albums['idAlbum'] + '" class="photo">\
                            <p class="titrePhoto">' + albums['titreAlbum'] + '</p>';
              _results1.push($.getJSON("/PictoRest/rest/photoRecherche/" + albums['photoCouv'] + "?callback=?", function(dataPix) {
                console.log(dataPix['idPhoto']);
                photos += '<img src="' + dataPix['cheminThumb'] + '"/>\
                        <p class="description">' + albums['desc'] + '</p>\
                      </div>\
                  </a>';
                console.log(photos);
                element = jQuery(photos);
                return $('#rech').append(element);
              }));
            }
            return _results1;
          });
        }));
      }
      return _results;
    });
  };

  window.ajoutFeed = function(id, idAlbum) {
    return $.post('/PictoRest/rest/users/' + id + '/feeds', {
      idAlbum: idAlbum
    });
  };

}).call(this);
