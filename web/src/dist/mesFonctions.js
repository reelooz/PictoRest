// Generated by CoffeeScript 1.6.3
(function() {
  window.rechercheAjax = function(idUtil) {
    var tabAlb, tabid, tache;
    tache = $("#recherche").val();
    tabid = [];
    tabAlb = [];
    return $.getJSON("/PictoRest/rest/albums?filter=" + tache + "&callback=?", function(data) {
      var d, element, photos, section, _i, _len, _results;
      $('section').remove();
      $('#rech').remove();
      $('#photo').remove();
      section = '<div id="rech"></div>';
      element = jQuery(section);
      $('body').append(element);
      _results = [];
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        d = data[_i];
        photos = '<a class="aphoto" href="/PictoRest/profil/' + d['idAlbum'] + '">\
                  <div id="' + d['idAlbum'] + '" class="photo">\
                    <p class="titrePhoto">Album : ' + d['titreAlbum'] + '</p>\
                    <img src=""/>\
                    <p class="description">' + d['desc'] + '</p>\
                  </div>\
                </a>';
        tabAlb.push(d);
        element = jQuery(photos);
        _results.push($('#rech').append(element));
      }
      return _results;
    }).done(function() {
      var alb, _i, _len;
      for (_i = 0, _len = tabAlb.length; _i < _len; _i++) {
        alb = tabAlb[_i];
        $.getJSON("/PictoRest/rest/photoRecherche/" + alb['photoCouv'] + "?callback=?", function(dataPhoto) {
          return $('#' + dataPhoto['idAlbum']).children('img').attr('src', dataPhoto['cheminThumb']);
        });
      }
      return $.getJSON("/PictoRest/rest/users/" + idUtil + "/feeds?callback=?", function(dataFeed) {
        var abo, element, feed, _j, _k, _len1, _len2, _results;
        for (_j = 0, _len1 = tabAlb.length; _j < _len1; _j++) {
          alb = tabAlb[_j];
          abo = '<a onClick="ajoutFeed(' + idUtil + ',' + alb['idAlbum'] + ')">S\'abonner</a>';
          element = jQuery(abo);
          $('#' + alb['idAlbum']).append(element);
        }
        if (dataFeed.length !== 0) {
          _results = [];
          for (_k = 0, _len2 = dataFeed.length; _k < _len2; _k++) {
            feed = dataFeed[_k];
            console.log(feed['idUtil']);
            console.log(feed['idAlbum']);
            _results.push($('#' + feed['idAlbum']).children('a').remove());
          }
          return _results;
        }
      });
    });
  };

  window.afficheflux = function(id) {
    var element, photos, tabAlbUtil, tabFeed, tabPhotos;
    tabFeed = [];
    tabAlbUtil = [];
    tabPhotos = [];
    $('section').remove();
    $('#rech').remove();
    $('#photo').remove();
    photos = '<div id="rech"> </div>';
    element = jQuery(photos);
    $('body').append(element);
    photos = '';
    $.getJSON("/PictoRest/rest/users/" + id + "/feeds?callback=?", function(data) {
      var feed, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        feed = data[_i];
        _results.push(tabFeed.push(feed));
      }
      return _results;
    }).done(function() {
      var feed, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = tabFeed.length; _i < _len; _i++) {
        feed = tabFeed[_i];
        _results.push($.getJSON("/PictoRest/rest/albums/" + feed['idAlbum'] + "/photos?callback=?", function(dataPhoto) {
          var photo, _j, _len1, _results1;
          _results1 = [];
          for (_j = 0, _len1 = dataPhoto.length; _j < _len1; _j++) {
            photo = dataPhoto[_j];
            _results1.push(tabPhotos.push(photo));
          }
          return _results1;
        }).done(function() {
          var photo, _j, _len1, _results1;
          console.log(tabPhotos.length);
          _results1 = [];
          for (_j = 0, _len1 = tabPhotos.length; _j < _len1; _j++) {
            photo = tabPhotos[_j];
            photos = '<a class="aphoto" href="/PictoRest/photo/' + photo['idPhoto'] + '">\
                          <div id="' + photo['idPhoto'] + '" class="photo">\
                            <p class="titrePhoto">' + photo['titrePhoto'] + '</p>\
                            <img src="' + photo['cheminThumb'] + '">\
                            <p class="description">' + photo['desc'] + '</p>\
                            </div>\
                          </a>';
            element = jQuery(photos);
            _results1.push($('#rech').append(element));
          }
          return _results1;
        }));
      }
      return _results;
    });
    return $.getJSON("/PictoRest/rest/users/" + id + "/albums?callback=?", function(dataUtil) {
      var albums, _i, _len, _results;
      if (dataUtil.length !== 0) {
        _results = [];
        for (_i = 0, _len = dataUtil.length; _i < _len; _i++) {
          albums = dataUtil[_i];
          tabAlbUtil.push(albums);
          console.log(albums);
          _results.push($.getJSON("/PictoRest/rest/albums/" + albums['idAlbum'] + "/photos?callback=?", function(dataPhoto) {
            var photo, _j, _len1, _results1;
            _results1 = [];
            for (_j = 0, _len1 = dataPhoto.length; _j < _len1; _j++) {
              photo = dataPhoto[_j];
              photos = '<a class="aphoto" href="/PictoRest/photo/' + photo['idPhoto'] + '">\
                          <div id="' + photo['idPhoto'] + '" class="photo">\
                            <p class="titrePhoto">' + photo['titrePhoto'] + '</p>\
                            <img src="' + photo['cheminThumb'] + '">\
                            <p class="description">' + photo['desc'] + '</p>\
                            </div>\
                          </a>';
              element = jQuery(photos);
              _results1.push($('#rech').append(element));
            }
            return _results1;
          }));
        }
        return _results;
      }
    });
  };

  window.ajoutFeed = function(id, idAlbum) {
    return $.post('/PictoRest/rest/users/' + id + '/feeds', {
      idAlbum: idAlbum
    });
  };

}).call(this);
